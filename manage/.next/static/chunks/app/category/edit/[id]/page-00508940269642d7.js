(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8396],{24654:function(){},71326:function(e,t,n){Promise.resolve().then(n.bind(n,16278))},42987:function(e,t,n){"use strict";n.d(t,{AT:function(){return r},GC:function(){return i},lI:function(){return u},m7:function(){return a},y1:function(){return c}});var l=n(49135),o=n(13374),s=n.n(o);async function r(e){return l.Z.get("/api/categories?".concat(s().stringify(e)))}async function i(e){return l.Z.post("/api/categories",e)}async function u(e){return l.Z.delete("/api/categories/".concat(e))}async function a(e){return l.Z.get("/api/categories/".concat(e))}async function c(e,t){return l.Z.put("/api/categories/".concat(e),t)}},10980:function(e,t,n){"use strict";n.d(t,{g:function(){return o}});var l=n(49135);async function o(e){return l.Z.post("/api/upload",e)}},16278:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var l=n(3827),o=n(42987),s=n(89480),r=n(47907),i=n(64090);function u(){let e=(0,r.useParams)(),t=e.id;console.log(t);let[n,u]=(0,i.useState)({});return(0,i.useEffect)(()=>{(async()=>{if(t){let e=await (0,o.m7)(t);console.log(e),u(e.data)}})()},[e]),(0,l.jsx)(s.default,{title:"分类编辑",data:n})}},89480:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var l=n(3827),o=n(64090),s=n(81583),r=n(80588),i=n(44839),u=n(82047),a=n(66577),c=n(32743),d=n(13565),f=n(66155),p=n(74325),m=n(47907),h=n(92064),g=n.n(h),v=n(20629),x=n(94292),j=n(42987),b=n(10980),Z=n(22319);function y(e){let{title:t,data:n}=e,h=(0,m.useRouter)(),[y,_]=(0,o.useState)(1),[C,N]=(0,o.useState)([]),[P,k]=(0,o.useState)(!1),[w,S]=(0,o.useState)(""),[E]=s.Z.useForm(),[I,O]=(0,o.useState)(!1),[T,q]=(0,o.useState)(""),[F,z]=(0,o.useState)(""),[G,L]=(0,o.useState)([]);(0,o.useEffect)(()=>{console.log(n),(null==n?void 0:n._id)&&E.setFieldsValue({...n})},[n,E]);let U=async e=>{console.log(e),e.icon=w,(null==n?void 0:n._id)?(await (0,j.y1)(null==n?void 0:n._id,e),r.ZP.success("更新成功")):(await (0,j.GC)(e),r.ZP.success("创建成功")),h.push("/category")};(0,o.useEffect)(()=>{!async function(){let e=await (0,j.AT)({all:!0,level:1});console.log(e),N(e.data)}()},[]);let A=(0,o.useMemo)(()=>C.map(e=>({value:e._id,label:e.name})),[C]);(0,o.useEffect)(()=>{(async()=>{await (0,b.g)().then(e=>{console.log("token",e.data.token),z(e.data.token)})})()},[]);let B=(0,l.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[P?(0,l.jsx)(f.Z,{}):(0,l.jsx)(p.Z,{}),(0,l.jsx)("div",{style:{marginTop:8},children:"上传"})]});return(0,l.jsx)(v.Z,{title:t,children:(0,l.jsxs)(s.Z,{labelCol:{span:8},wrapperCol:{span:16},layout:"horizontal",onFinish:U,form:E,children:[(0,l.jsx)(s.Z.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称"}],children:(0,l.jsx)(i.default,{placeholder:"请输入"})}),(0,l.jsx)(s.Z.Item,{label:"级别",name:"level",rules:[{required:!0,message:"请选择级别"}],children:(0,l.jsx)(u.default,{onChange:e=>{_(e)},options:x.B,placeholder:"请选择",disabled:!!(null==n?void 0:n._id)})}),(2==y||(null==n?void 0:n.level)===2)&&(0,l.jsx)(s.Z.Item,{label:"所属级别",name:"parent",rules:[{required:!0,message:"请选择级别"}],children:(0,l.jsx)(u.default,{options:A,placeholder:"请选择",children:(0,l.jsx)(u.default.Option,{value:"demo",children:"Demo"})})}),(2==y||(null==n?void 0:n.level)===2)&&(0,l.jsx)(s.Z.Item,{label:"分类图标",name:"icon",rules:[{required:!0,message:"请选择图片"}],children:(0,l.jsx)(a.Z,{name:"file",listType:"picture-card",className:"avatar-uploader",action:"http://upload-z2.qiniup.com",data:{token:F},beforeUpload:e=>{let t="image/jpeg"===e.type||"image/png"===e.type;return t||r.ZP.error("You can only upload JPG/PNG file!"),t},fileList:G,onPreview:e=>{console.log(e),q(e.url||e.thumbUrl),O(!0)},onChange:e=>{let t=e.file,n=e.fileList;console.log("fileList",e.fileList);let{uid:l,name:o,type:s,thumbUrl:r,status:i,response:u={}}=t,a={uid:l,name:o,type:s,thumbUrl:r,status:i,url:Z._+(u.hash||"")};S(a.url||a.thumbUrl),n.pop(),n.push(a),console.log(n),L([...n])},onRemove:e=>{console.log(e);let t=G.indexOf(e);-1!==t&&G.splice(t,1),L([...G])},maxCount:1,children:G.length>=1||(null==n?void 0:n.icon)?(null==n?void 0:n.icon)?(0,l.jsx)("img",{src:null==n?void 0:n.icon,alt:""}):"":B})}),(0,l.jsx)(s.Z.Item,{children:(0,l.jsx)(c.Z,{open:I,title:"预览",footer:null,onCancel:()=>{O(!1)},children:(0,l.jsx)("img",{alt:"example",style:{width:"100%"},src:T})})}),(0,l.jsx)(s.Z.Item,{colon:!1,children:(0,l.jsx)(d.ZP,{size:"large",htmlType:"submit",className:g().btn,children:(null==n?void 0:n._id)?"更新":"创建"})})]})})}},20629:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var l=n(3827);n(64090);var o=n(71583),s=n.n(o);function r(e){let{children:t,title:n,operation:o}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:s().title,children:[n,(0,l.jsx)("span",{className:s().btn,children:o})]}),(0,l.jsx)("div",{className:s().content,children:t})]})}},94292:function(e,t,n){"use strict";n.d(t,{B:function(){return o}});let l={ONE:1,TWO:2},o=[{label:"级别1",value:l.ONE},{label:"级别2",value:l.TWO}]},22319:function(e,t,n){"use strict";n.d(t,{_:function(){return l}});let l="http://sw1e12f9k.hn-bkt.clouddn.com/"},49135:function(e,t,n){"use strict";var l=n(7908),o=n(37134),s=n(80588);t.Z=(e=>{let t=l.Z.create({timeout:5e3,...e});return t.interceptors.request.use(function(e){let t=localStorage.getItem("user"),n=t?JSON.parse(t).token:"";return e.headers.Authorization="Bearer "+n,e},function(e){return Promise.reject(e)}),t.interceptors.response.use(function(e){let{status:t,data:n,message:l}=e;return 200===t?n:401===t?o.default.push("/login"):void s.ZP.error(l||"服务端异常")},function(e){var t,n;return e.response&&401===e.response.status?o.default.push("/login"):(s.ZP.error((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"服务端异常"),Promise.reject(e))}),t})({})},92064:function(e){e.exports={btn:"CategoryForm_btn__kYNid"}},71583:function(e){e.exports={content:"Content_content__iP7sw",title:"Content_title__y3NnI",btn:"Content_btn__bySTU"}}},function(e){e.O(0,[4634,534,3565,7172,1583,7119,3374,1716,1026,8728,2874,2971,8069,1744],function(){return e(e.s=71326)}),_N_E=e.O()}]);